
create table CUSTOMER (
    CUSTOMER_KEY int,
    FIO varchar(100),
    AGE int
);

alter table CUSTOMER add constraint customer_pk primary key(CUSTOMER_KEY);

INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (1,'Nolan Walters',59);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (2,'Hop Klein',31);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (3,'Grant Kim',69);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (4,'Ulric Foley',19);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (5,'Cameron Cross',89);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (6,'Guy Larson',26);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (7,'Evan Sweet',66);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (8,'Geoffrey Puckett',80);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (9,'Xenos Moss',77);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (10,'Aladdin Floyd',66);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (11,'Uriel Hill',44);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (12,'Addison Hays',63);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (13,'Hammett Edwards',56);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (14,'Isaac Cruz',43);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (15,'Graham Roy',34);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (16,'Garrison Aguirre',84);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (17,'Tate Olson',18);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (18,'Dieter Wolfe',27);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (19,'Hunter Drake',22);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (20,'Beau Floyd',41);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (21,'Reece Ramirez',77);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (22,'Quentin Casey',49);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (23,'Damon Bridges',68);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (24,'Otto Mcknight',52);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (25,'Lev Ferguson',35);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (26,'Lewis Miranda',80);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (27,'Sylvester Roberts',71);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (28,'Wang Wells',26);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (29,'Logan Dillon',59);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (30,'Richard Silva',40);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (31,'Ferris Miranda',32);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (32,'Vaughan Cameron',44);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (33,'Cyrus Jones',87);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (34,'Macon Carrillo',37);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (35,'Tarik Mayo',37);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (36,'Aaron Branch',73);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (37,'Wylie Sparks',18);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (38,'Arden Barnett',19);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (39,'Barrett Carson',83);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (40,'Tanek Mueller',34);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (41,'Cruz Sullivan',38);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (42,'Hakeem Bond',73);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (43,'Dillon Mendoza',77);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (44,'Jason Velez',47);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (45,'Armand Roach',22);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (46,'Kamal Ortega',30);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (47,'Bert Hahn',47);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (48,'Sean Dillard',60);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (49,'Salvador Baxter',25);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (50,'Elvis Cotton',46);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (51,'Uriah Ramos',82);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (52,'Xenos Burke',79);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (53,'Gary Aguilar',82);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (54,'Philip Ford',28);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (55,'Dexter Hopper',47);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (56,'Felix Moon',80);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (57,'George Osborn',23);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (58,'Abraham Ball',25);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (59,'Bernard Farmer',46);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (60,'Paki Duran',73);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (61,'Acton Lancaster',71);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (62,'Lars Blankenship',76);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (63,'Herrod Weber',75);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (64,'Thane Lindsay',23);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (65,'Erich Woodard',20);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (66,'Paul Guthrie',30);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (67,'Brady Kelly',47);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (68,'Jeremy Shelton',17);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (69,'Hamilton Conway',86);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (70,'Noah Hansen',19);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (71,'Hilel Baird',75);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (72,'Nasim Albert',78);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (73,'Tiger Cole',68);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (74,'Gabriel Sykes',27);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (75,'Bruno Alexander',34);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (76,'Brett Davenport',60);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (77,'Tucker Torres',22);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (78,'Myles Mcfadden',75);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (79,'Acton Levy',55);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (80,'Owen Glover',72);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (81,'Dalton Fuller',29);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (82,'Stuart Moss',90);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (83,'Yasir Cruz',16);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (84,'Harding Raymond',88);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (85,'Joshua Washington',24);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (86,'Colton Salazar',18);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (87,'Colt Riddle',23);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (88,'Brody Mcconnell',55);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (89,'Alec Gillespie',90);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (90,'Chaim Kaufman',19);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (91,'Scott Mcdowell',64);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (92,'Philip Stark',62);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (93,'Lucas Thompson',74);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (94,'Gareth Rios',58);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (95,'Arden Cross',75);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (96,'Jameson Francis',63);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (97,'Emerson Caldwell',61);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (98,'Amery Finley',44);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (99,'Stephen Munoz',42);
INSERT INTO CUSTOMER (CUSTOMER_KEY,FIO,AGE) VALUES (100,'Philip Dunn',29);


create table PURCHASE (
    PURCHASE_KEY int,
    CUSTOMER_KEY int,
    PRODUCT_KEY int,
    QTY int,
    `DATE` date
);

INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (8,32,11,5,STR_TO_DATE('27.01.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (8,32,8,2,STR_TO_DATE('27.01.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (19,57,15,1,STR_TO_DATE('17.02.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (19,57,30,8,STR_TO_DATE('17.02.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (19,57,24,2,STR_TO_DATE('17.02.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (27,58,6,2,STR_TO_DATE('16.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (27,58,22,6,STR_TO_DATE('16.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (27,58,18,9,STR_TO_DATE('16.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (27,58,17,1,STR_TO_DATE('16.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (6,16,9,9,STR_TO_DATE('22.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (6,16,23,5,STR_TO_DATE('22.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (6,16,3,6,STR_TO_DATE('22.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (6,16,28,1,STR_TO_DATE('22.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (45,33,16,1,STR_TO_DATE('29.12.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (45,33,21,9,STR_TO_DATE('29.12.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (45,33,30,9,STR_TO_DATE('29.12.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (11,68,24,9,STR_TO_DATE('13.09.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (11,68,17,7,STR_TO_DATE('13.09.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (30,33,14,4,STR_TO_DATE('27.02.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (10,50,2,1,STR_TO_DATE('23.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (10,50,1,5,STR_TO_DATE('23.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (10,50,18,4,STR_TO_DATE('23.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (10,50,5,1,STR_TO_DATE('23.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (42,10,17,4,STR_TO_DATE('31.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (42,10,26,1,STR_TO_DATE('31.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (42,10,23,8,STR_TO_DATE('31.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (42,10,29,1,STR_TO_DATE('31.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (42,10,7,7,STR_TO_DATE('31.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (3,51,27,5,STR_TO_DATE('20.07.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (4,99,23,10,STR_TO_DATE('22.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (4,99,9,5,STR_TO_DATE('22.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (4,99,4,10,STR_TO_DATE('22.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (4,99,30,10,STR_TO_DATE('22.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (4,99,13,7,STR_TO_DATE('22.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (4,99,3,4,STR_TO_DATE('22.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (31,19,30,7,STR_TO_DATE('30.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (31,19,4,10,STR_TO_DATE('30.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (39,13,9,5,STR_TO_DATE('07.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (39,13,30,7,STR_TO_DATE('07.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (39,13,20,8,STR_TO_DATE('07.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (9,50,27,4,STR_TO_DATE('30.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (9,50,21,7,STR_TO_DATE('30.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (38,71,7,8,STR_TO_DATE('28.11.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (38,71,4,10,STR_TO_DATE('28.11.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (17,55,16,9,STR_TO_DATE('03.03.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (13,22,1,6,STR_TO_DATE('30.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (13,22,13,5,STR_TO_DATE('30.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (13,22,21,7,STR_TO_DATE('30.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (13,22,9,4,STR_TO_DATE('30.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (22,94,20,6,STR_TO_DATE('23.11.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (26,57,20,5,STR_TO_DATE('14.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (26,57,18,8,STR_TO_DATE('14.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (16,45,17,7,STR_TO_DATE('09.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (16,45,17,1,STR_TO_DATE('09.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (16,45,7,4,STR_TO_DATE('09.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (16,45,10,8,STR_TO_DATE('09.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (5,87,29,1,STR_TO_DATE('22.03.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (5,87,24,5,STR_TO_DATE('22.03.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (5,87,21,8,STR_TO_DATE('22.03.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (7,77,17,8,STR_TO_DATE('05.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (20,50,11,4,STR_TO_DATE('01.09.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (18,76,30,8,STR_TO_DATE('17.11.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (18,76,4,3,STR_TO_DATE('17.11.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (2,73,19,5,STR_TO_DATE('04.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (2,73,9,1,STR_TO_DATE('04.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (2,73,7,10,STR_TO_DATE('04.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (36,94,14,10,STR_TO_DATE('12.01.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (48,42,23,8,STR_TO_DATE('06.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (33,77,25,9,STR_TO_DATE('28.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (33,77,13,7,STR_TO_DATE('28.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (33,77,1,1,STR_TO_DATE('28.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (33,77,12,7,STR_TO_DATE('28.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (1,66,20,6,STR_TO_DATE('14.03.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (1,66,25,6,STR_TO_DATE('14.03.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (1,66,12,1,STR_TO_DATE('14.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (49,9,30,7,STR_TO_DATE('04.12.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (24,52,15,8,STR_TO_DATE('08.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (24,52,28,6,STR_TO_DATE('08.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (24,52,10,4,STR_TO_DATE('08.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (35,17,24,3,STR_TO_DATE('31.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (35,17,26,10,STR_TO_DATE('31.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (35,17,10,2,STR_TO_DATE('31.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (35,17,22,7,STR_TO_DATE('31.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (35,77,15,4,STR_TO_DATE('31.10.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (47,17,26,5,STR_TO_DATE('26.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (47,17,30,6,STR_TO_DATE('26.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (47,17,2,8,STR_TO_DATE('26.08.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (37,99,22,2,STR_TO_DATE('20.03.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (25,87,27,9,STR_TO_DATE('11.03.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (25,87,28,4,STR_TO_DATE('11.03.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (15,11,29,4,STR_TO_DATE('21.02.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (15,11,21,10,STR_TO_DATE('21.02.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (15,11,29,9,STR_TO_DATE('21.02.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (15,11,26,7,STR_TO_DATE('21.02.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (50,87,27,9,STR_TO_DATE('16.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (32,98,1,1,STR_TO_DATE('21.07.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (32,98,20,2,STR_TO_DATE('21.07.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (44,13,4,3,STR_TO_DATE('01.11.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (21,53,6,2,STR_TO_DATE('30.09.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (41,44,29,2,STR_TO_DATE('24.01.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (12,88,29,2,STR_TO_DATE('02.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (12,88,30,2,STR_TO_DATE('02.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (12,88,2,2,STR_TO_DATE('02.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (12,88,7,2,STR_TO_DATE('02.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (12,88,5,2,STR_TO_DATE('02.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (14,44,1,2,STR_TO_DATE('03.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (14,44,2,2,STR_TO_DATE('03.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (14,44,3,2,STR_TO_DATE('03.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (14,44,4,2,STR_TO_DATE('03.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (14,44,5,2,STR_TO_DATE('03.05.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (23,54,1,10,STR_TO_DATE('11.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (23,54,6,5,STR_TO_DATE('11.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (23,54,4,10,STR_TO_DATE('11.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (23,54,30,10,STR_TO_DATE('11.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (57,19,1,7,STR_TO_DATE('30.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (57,19,6,10,STR_TO_DATE('30.04.2018','%d.%m.%Y'));
INSERT INTO PURCHASE (PURCHASE_KEY,CUSTOMER_KEY,PRODUCT_KEY,QTY,`DATE`) VALUES (58,79,1,2,STR_TO_DATE('16.04.2018','%d.%m.%Y'));




create table PRODUCT (
    PRODUCT_KEY int,
    CATEGORY_KEY int,
    NAME varchar(100),
    PRICE int
);



INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (1,1,'TEDDY',1172);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (2,5,'Tristique Aliquet Limited',655);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (3,3,'Non Lobortis Institute',1373);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (4,3,'Sociis Natoque Company',397);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (5,4,'Urna Nullam Lobortis Company',2176);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (6,2,'LEGO',562);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (7,2,'Elit Aliquam Company',727);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (8,5,'Mattis Integer Eu Consulting',824);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (9,4,'A Odio Inc.',512);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (10,3,'Tempus Lorem Inc.',1269);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (11,4,'Donec Fringilla Donec LLP',2462);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (12,1,'Et Foundation',1282);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (13,1,'At LLP',639);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (14,1,'Consectetuer Euismod Inc.',1093);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (15,5,'Feugiat Consulting',1955);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (16,3,'Arcu Vel Quam Incorporated',956);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (17,5,'Magna Nam Ligula Company',1999);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (18,5,'Orci Ut Industries',493);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (19,1,'Malesuada Fames Ac Corporation',1312);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (20,5,'Orci Phasellus Dapibus Company',976);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (21,1,'Ligula Aliquam Erat Industries',2160);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (22,2,'Magnis Dis Parturient Foundation',938);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (23,3,'Senectus Industries',1794);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (24,2,'Velit Inc.',387);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (25,5,'Erat Neque Non LLP',1820);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (26,4,'Consectetuer Adipiscing Associates',2148);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (27,4,'Enim Condimentum PC',51);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (28,3,'Odio Auctor Corp.',730);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (29,1,'Diam Ltd',1371);
INSERT INTO PRODUCT (PRODUCT_KEY,CATEGORY_KEY,NAME,PRICE) VALUES (30,2,'Duis Volutpat Nunc Consulting',354);


-- a.	Какой средний возраст клиентов, купивших плюшевого мишку (использовать наименование товара PRODUCT.NAME) в 2018 году?
select AVG(AGE)
from CUSTOMER AS CU
left join PURCHASE AS PU USING(CUSTOMER_KEY)
left join PRODUCT AS PR USING(PRODUCT_KEY)
WHERE 1=1
	AND NAME = 'TEDDY'
	AND YEAR(`DATE`) = '2018';

-- b.	Вывести ФИО покупателей, которые приобретали одновременно плюшевого мишку и набор LEGO (использовать наименование товара PRODUCT.NAME)
SELECT *
from CUSTOMER AS CU
left join PURCHASE AS PU USING(CUSTOMER_KEY)
left join PRODUCT AS PR USING(PRODUCT_KEY)
WHERE 1=1
  AND NAME IN ('TEDDY','LEGO');
-- в апреле 2018 года;
SELECT FIO
from CUSTOMER AS CU
left join PURCHASE AS PU USING(CUSTOMER_KEY)
left join PRODUCT AS PR USING(PRODUCT_KEY)
WHERE 1=1
  AND NAME IN ('TEDDY','LEGO')
  AND `DATE` BETWEEN  '2018-04-01' AND '2018-04-30';

-- c.	Какие топ-3 самых продаваемых товара в категории «TOYS» (использовать наименование категории PRODUCT_CATEGORY.CATEGORY)
-- за 2018 год в разбивке по месяцам?
SELECT WEEK(`DATE`),`NAME`,COUNT(`NAME`)
FROM PRODUCT_CATEGORY AS PR_C
LEFT JOIN PRODUCT AS PR USING(CATEGORY_KEY)
LEFT JOIN PURCHASE AS PU USING(PRODUCT_KEY)
WHERE 1=1
	AND CATEGORY = 'TOYS'
    AND YEAR(`DATE`) = '2018'
GROUP BY WEEK(`DATE`),`NAME`
ORDER BY COUNT(`NAME`) DESC LIMIT 3;

-- d.	Вывести ФИО клиентов, у которых сумма покупок за майские праздники (можно взять производственный календарь) превышает 20000 рублей.
SELECT *
from CUSTOMER AS CU
LEFT JOIN PURCHASE AS PU USING(CUSTOMER_KEY)
LEFT JOIN PRODUCT AS PR USING(PRODUCT_KEY)
WHERE 1=1


-- SELECT AVG(AGE)
-- FROM CUSTOMER
-- LEFT JOIN PURCHASE USING(CUSTOMER_KEY)
-- LEFT JOIN PRODUCT USING(PRODUCT_KEY)
-- WHERE 1=1
--     AND "NAME" = 'TEDDY'
--     AND TO_CHAR("DATE",'YYYY') = '2018';

-- SELECT FIO
-- FROM CUSTOMER
-- LEFT JOIN PURCHASE USING(CUSTOMER_KEY)
-- LEFT JOIN PRODUCT USING(PRODUCT_KEY)
-- WHERE 1=1
--   AND "NAME" IN ('TEDDY','LEGO')
--   AND "DATE" BETWEEN TO_DATE('2018-04-01', 'yyyy-mm-dd') and TO_DATE('2018-04-30', 'yyyy-mm-dd');

-- SELECT "MONTH","NAME"
-- FROM (
-- SELECT EXTRACT (MONTH FROM "DATE") "MONTH","NAME" ,COUNT("NAME")
-- FROM PRODUCT_CATEGORY
-- LEFT JOIN PRODUCT USING(CATEGORY_KEY)
-- LEFT JOIN PURCHASE USING(PRODUCT_KEY)
-- WHERE 1=1
--  AND CATEGORY = 'TOYS'
--  AND TO_CHAR("DATE",'YYYY') = '2018'
-- GROUP BY EXTRACT (MONTH FROM "DATE"),"NAME"
-- ORDER BY COUNT("NAME") DESC
-- FETCH FIRST 3 ROWS ONLY);

-- d. Вывести ФИО клиентов, у которых сумма покупок за майские праздники (можно взять производственный календарь) превышает 20000 рублей

-- Создаем производственный календарь
-- CREATE TABLE HOLIDAY (
--     DAY_HOLIDAY date
-- );

-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.01.01','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.01.02','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.01.03','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.01.04','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.01.05','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.01.06','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.01.07','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.01.08','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.02.22','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.02.23','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.03.07','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.03.08','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.03.09','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.04.28','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.04.30','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.05.01','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.05.02','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.05.08','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.05.09','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.06.09','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.06.11','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.06.12','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.11.04','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.11.05','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.12.29','YYYY.MM.DD'));
-- INSERT INTO HOLIDAY (DAY_HOLIDAY) VALUES (to_date('2018.12.31','YYYY.MM.DD'));

-- SELECT FIO
-- FROM (SELECT FIO,SUM(PRICE) SUM_PR
-- FROM CUSTOMER
-- LEFT JOIN PURCHASE USING(CUSTOMER_KEY)
-- LEFT JOIN PRODUCT USING(PRODUCT_KEY)
-- WHERE "DATE" IN (SELECT * FROM HOLIDAY WHERE EXTRACT (MONTH FROM DAY_HOLIDAY) = 5)
-- GROUP BY FIO
-- HAVING SUM(PRICE) > 2000)


 CREATE TABLE NEW_VIT (
   `EMPLOYEE_ID` INT
  ,`NAME` VARCHAR(100)
  ,`PHONE_NUMBER` INT
  ,`HIRE_DATE` timestamp
  ,`JOB_TITLE` VARCHAR(100)
  ,`SALARY` DECIMAL(5,2)
  ,`POTENTIAL_MAX_SALARY_INCREASE` DECIMAL(5,2)
  ,`DEPARTMENT_NAME` VARCHAR(100)
  ,`COUNTRY` VARCHAR(100)
  ,`CITY` VARCHAR(100)
  ,`STATE` VARCHAR(100)
  ,`STREET` VARCHAR(100)
  ,`START_DT` timestamp NOT NULL DEFAULT '1970-01-01 00:00:01'
  ,`END_DT` timestamp NOT NULL DEFAULT '2030-01-01 00:00:00'
  ,PRIMARY KEY(`EMPLOYEE_ID`,`START_DT`)
  ,UNIQUE KEY `uniq` (`EMPLOYEE_ID`,`END_DT`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

INSERT IGNORE INTO NEW_VIT
(`EMPLOYEE_ID`
,`NAME`
,`PHONE_NUMBER`
,`HIRE_DATE`
,`JOB_TITLE`
,`SALARY`
,`POTENTIAL_MAX_SALARY_INCREASE`
,`DEPARTMENT_NAME`
,`COUNTRY`
,`CITY`
,`STATE`
,`STREET`
,`START_DT`
,`END_DT`
)
VALUES
(SELECT
`EM`.`EMPLOYEE_ID`
,`EM`.`NAME`
,`EM`.`PHONE_NUMBER`
,`EM`.`HIRE_DATE`
,`EM`.`JOB_TITLE`
,`EM`.`SALARY`
, 100-(100/`JO``.MAX_SALARY`*`EM`.`SALARY`) AS `POTENTIAL_MAX_SALARY_INCREASE`
,`DE`.`DEPARTMENT_NAME`
,`LO`.`COUNTRY`
,`LO`.`CITY`
,`LO`.`STATE`
,`LO`.`STREET`
,NOW()
,'2030-01-01 00:00:00'
FROM `EMPLOYEE` AS `EM`
LEFT JOIN `JOB` AS `JO` USING(JOB_ID)
LEFT JOIN `DEPARTAMENT` AS `DE` USING(`DEPARTAMENT_ID`)
LEFT JOIN `LOCATION` AS `LO` USING(`LOCATION_ID`)
on duplicate key update `END_DT`=NOW()
);

